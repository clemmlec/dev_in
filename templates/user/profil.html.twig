{% extends "base.html.twig" %}
{% block title %}
    profil | {{ parent() }}
{% endblock %}
{% block meta %} 
    <meta name="description" 
        content="La page de profil de {{user.name}} sue Dev In, le site d'entraide entre devs" 
    /> 
    <meta name="robots" 
        content="index,follow" 
    /> 
{% endblock %}
{% block stylesheets %}
    {{ encore_entry_link_tags('app') }}
    {{ parent()}}
{% endblock %}

{% block javascripts %}
    {{ encore_entry_script_tags('app') }}
    {{ parent()}}
{% endblock %}

{% block body %}
<section class="w-80">
    <h1 class="break">Profil de {{user.name}}</h1>
    <section class="d-flex reverse">
    {% if app.user and app.user.id == user.id %}
        <section id="btnProfil">
            <button id="myBtn2" class="" onclick="modal(this)">modifier le profil</button>
            <button id="myBtn3" class="" onclick="modal(this)">couleur de profil</button>
        </section>
                
        {% include "user/edit.html.twig" %}  
     
    {% endif %}

        <div id="profilCard" class="swiper-slide card mt-5" style="{{user.style}}">
            <h3 class="toptitre photo b-50 gris">
                <img class="avatar" src="{{ user.imageName ? vich_uploader_asset(user, 'imageFile') : "https://fakeimg.pl/200x100" }}" alt="{{user.name}}">
            </h3>
            <h3 class="date">inscrit {{user.createdAt | ago}}
            {% if app.user and app.user.id != user.id %}
                <button type="button" class="btn-vierge yellow" value="{{user.id}}" data-follow-user >
                    {% set fav = false %}
                    
                    {% for row in app.user.getFollows %}
                
                        {% if row.friend.id == user.id %}
                            {% set fav = true %}
                        {% endif %}
                    {% endfor %}
                    {% if fav %}
                        <i class="fa fa-user pointer yellow"></i>
                    {% else %}
                        <i class="far fa-user pointer yellow"></i>
                        
                    {% endif %}

                </button>
            {% endif %}
            </h3>
            <h2>{{user.followers | length}} followers</h2>
            {% if user.subjects %}
                <h2>{{user.subjects | length }} subjects postés</h2>
                {% set moyenne = 0 %}
                {% set nbVote = 0 %}
                {% for row in user.subjects %}
                    {% for note in row.noteSubjects %}
                        {% set moyenne = moyenne + note.note %}
                        {% set nbVote = nbVote +1 %}
                    {% endfor %}
                {% endfor %}
                {% if nbVote > 0 %}
                    {% set moyenne = moyenne / nbVote %}
                    <h2>Moyenne subjects {{ moyenne | round(2, 'floor') }}</h2>
                {% endif %}
                <h2>{{user.comments | length }} commantaires</h2>

            {% endif %}
            {# <button class="btn-vierge"><a href="{{ path('app_user_profil', {'id': follow.user.id}) }}">voir le profil</a></button> #}
            {# <a href="bb">dfgff sdg s sg </a> #}
        </div>


    </section>

    {% if user.follows | length > 0 %}
        <hr>
        <h1>abonnements {{user.follows | length}}</h1>
        <div class="swip ">
            <div class="swiper mySwiper">
                <div class="swiper-wrapper">
                    
                    {% for follow in user.follows %}
                    <div class="swiper-slide card" style="{{follow.friend.style}}">
                        <h3 class="toptitre photo b-50 gris">
                            <img class="avatar" src="{{ follow.friend.imageName ? vich_uploader_asset(follow.friend, 'imageFile') : "https://fakeimg.pl/200x100" }}" alt="{{follow.friend.name}}">
                        </h3>
                        <h1>{{follow.friend.name}}
                            {% if app.user and app.user.id == user.id %}
                                <button type="button" class="btn-vierge yellow" value="{{follow.friend.id}}" data-follow-user >
                                
                                    <i class="fa fa-user pointer yellow"></i>
                                
                                </button>
                            {% endif %}
                        </h1>
                        <h3 class="date">inscrit {{follow.friend.createdAt | ago}}</h3>
                        <h2>{{follow.friend.followers | length}} followers</h2>
                        {% if follow.friend.subjects %}
                            <h2>{{follow.friend.subjects | length }} subjects postés</h2>
                            {% set moyenne = 0 %}
                            {% set nbVote = 0 %}
                            {% for row in follow.friend.subjects %}
                                {% for note in row.noteSubjects %}
                                    {% set moyenne = moyenne + note.note %}
                                    {% set nbVote = nbVote +1 %}
                                {% endfor %}
                            {% endfor %}
                            {% if nbVote > 0 %}
                                {% set moyenne = moyenne / nbVote %}
                                <h2>Moyenne subjects {{ moyenne |round(2, 'floor') }}</h2>
                            {% endif %}
                        {% endif %}
                        {# <button>voir le profil</button> #}
                        <button  class="btn-vierge" ><a href="{{ path('app_user_profil', {'id': follow.friend.id}) }}">voir le profil</a></button>
                    </div>
                    {% endfor %}
                    
                </div>

                <!-- If we need navigation buttons -->
                <div class="swiper-pagination"></div>

                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>
        </div>     
    {% endif %}

    {% if user.followers | length > 0 %}
        <hr>
        <h1>abonnés {{user.followers | length}}</h1>
        <div class="swip ">
            <div class="swiper mySwiper">
                <div class="swiper-wrapper">
                    
                    {% for follow in user.followers %}
                    <div class="swiper-slide card" style="{{follow.user.style}}">
                        <h3 class="toptitre photo b-50 gris">
                            <img class="avatar" src="{{ follow.user.imageName ? vich_uploader_asset(follow.user, 'imageFile') : "https://fakeimg.pl/200x100" }}" alt="{{follow.user.name}}">
                        </h3>
                        <h1>{{follow.user.name}}
                            {% if app.user and app.user.id == user.id %}
                                <button type="button" class="btn-vierge yellow" value="{{follow.user.id}}" data-follow-user >
                                    {% set fav = false %}
                                    
                                    {% for row in app.user.getFollows %}
                                
                                        {% if row.friend.id == follow.user.id %}
                                            {% set fav = true %}
                                        {% endif %}
                                    {% endfor %}
                                    {% if fav %}
                                        <i class="fa fa-user pointer yellow"></i>
                                    {% else %}
                                        <i class="far fa-user pointer yellow"></i>
                                        
                                    {% endif %}
    
                                </button>
                            {% endif %}
                        </h1>
                        <h3 class="date">inscrit {{follow.user.createdAt | ago}}</h3>
                        <h2>{{follow.user.followers | length}} followers</h2>
                        {% if follow.user.subjects %}
                            <h2>{{follow.user.subjects | length }} subjects postés</h2>
                            {% set moyenne = 0 %}
                            {% set nbVote = 0 %}
                            {% for row in follow.user.subjects %}
                                {% for note in row.noteSubjects %}
                                    {% set moyenne = moyenne + note.note %}
                                    {% set nbVote = nbVote +1 %}
                                {% endfor %}
                            {% endfor %}
                            {% if nbVote > 0 %}
                                {% set moyenne = moyenne / nbVote %}
                                <h2>Moyenne subjects {{ moyenne | round(2, 'floor') }}</h2>
                            {% endif %}
                        {% endif %}
                        <button class="btn-vierge"><a href="{{ path('app_user_profil', {'id': follow.user.id}) }}">voir le profil</a></button>
                        {# <a href="bb">dfgff sdg s sg </a> #}
                    </div>
                    {% endfor %}
                    
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>
        </div>    
    {% endif %}

    {% if user.subjects | length > 0 %}
        <hr>
        <h1>subjects postés {{user.subjects | length}}</h1>
        <div class="swip ">
            <div class="swiper mySwiper">
                <div class="swiper-wrapper">
                    {% for subject in user.subjects %}
                        <div class="swiper-slide overflow-y card">
                            {% include "Components/_subjectSwiper.html.twig" with { subject: subject} %}
                        </div>
                    {% endfor %}
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>
        </div>    
    {% endif %}

    {% if user.subjectFavoris | length > 0 %}
        <hr>
        <h1>subjects favoris {{user.subjectFavoris | length}}</h1>
        <div class="swip ">
            <div class="swiper mySwiper">
                <div class="swiper-wrapper">
                {% for subject in user.subjectFavoris %}
                    <div class="swiper-slide overflow-y card">
                        {% include "Components/_subjectSwiper.html.twig" with { subject: subject.subject} %}
                    </div>
                {% endfor %}
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>
        </div>    
    {% endif %}

    {% if user.noteSubjects | length > 0 %}
        <hr>
        <h1>subjects notés {{user.noteSubjects | length}}</h1>
        <div class="swip ">
            <div class="swiper mySwiper">
                <div class="swiper-wrapper">
                {% for subject in user.noteSubjects %}
                    <div class="swiper-slide overflow-y card">
                        {% include "Components/_subjectSwiper.html.twig" with { subject: subject.subject} %}
                    </div>
                {% endfor %}
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>
        </div>    
    {% endif %}

    {% if user.articleLikeds | length > 0 %}
        <hr>
        <h1>articles likés {{user.articleLikeds | length}}</h1>
        <div class="swip ">
            <div class="swiper mySwiper">
                <div class="swiper-wrapper">
                {% for article in user.getArticleLikeds %}
                    <div class="swiper-slide overflow-y articleCard">
                        {% include "Components/_article.html.twig" with { couper: 'couper' , article: article.article} %}
                    </div>
                {% endfor %}
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
            </div>
        </div>    
    {% endif %}
    {% if app.user and app.user.id == user.id %}
    <button class="btn-vierge red" data-delete-compte>Supprimer mon compte</button>
    <div id="alertDelete">
        <h3>Vous êtes sur le point de supprimer votre compte</h3>
        <p>Toutes vos données seront supprimées de manieres irémediable <br>
            Etes vous sur de vouloir supprimer votre compte de manière definitive ?
        </p>
        <button class="btn-vierge red" data-delete> <a href=" {{path('delete')}}"> Oui je veux supprimer mon compte</a></button>
        <button class="btn-vierge green" data-retour>Non je veux garder mon compte</button>
    </div>
    {% endif %}
</section>
{% endblock %}