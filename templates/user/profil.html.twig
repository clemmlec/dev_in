{% extends "base.html.twig" %}
{% block title %}
    profil | {{ parent() }}
{% endblock %}

{% block stylesheets %}
    {{ encore_entry_link_tags('app') }}
    {{ parent()}}
{% endblock %}

{% block javascripts %}
    {{ encore_entry_script_tags('app') }}
    {{ parent()}}
{% endblock %}

{% block body %}
<h1>Profil de {{user.name}}</h1>
<section class="d-flex">
    
    <div id="profilCard" class="swiper-slide card mt-5" style="{{user.style}}">
        <h3 class="toptitre photo b-50 gris">
            <img class="avatar" src="{{ user.imageName ? vich_uploader_asset(user, 'imageFile') : "https://fakeimg.pl/200x100" }}" alt="{{user.name}}">
        </h3>
        <h3 class="date">inscrit {{user.createdAt | ago}}
        {% if app.user and app.user.id != user.id %}
            <button type="button" class="btn-vierge yellow" value="{{user.id}}" data-follow-user >
                {% set fav = false %}
                
                {% for row in app.user.getFollows %}
            
                    {% if row.friend.id == user.id %}
                        {% set fav = true %}
                    {% endif %}
                {% endfor %}
                {% if fav %}
                    <i class="fa fa-user pointer yellow"></i>
                {% else %}
                    <i class="far fa-user pointer yellow"></i>
                    
                {% endif %}

            </button>
        {% endif %}
        </h3>
        <h2>{{user.followers | length}} followers</h2>
        {% if user.memes %}
            <h2>{{user.memes | length }} memes postés</h2>
            {% set moyenne = 0 %}
            {% set nbVote = 0 %}
            {% for row in user.memes %}
                {% for note in row.noteMemes %}
                    {% set moyenne = moyenne + note.note %}
                    {% set nbVote = nbVote +1 %}
                {% endfor %}
            {% endfor %}
            {% if nbVote > 0 %}
                {% set moyenne = moyenne / nbVote %}
                <h2>Moyenne memes {{ moyenne | round(2, 'floor') }}</h2>
            {% endif %}
            <h2>{{user.comments | length }} commantaires</h2>

        {% endif %}
        {# <button class="btn-vierge"><a href="{{ path('app_user_profil', {'id': follow.user.id}) }}">voir le profil</a></button> #}
        {# <a href="bb">dfgff sdg s sg </a> #}
    </div>

    {% if app.user and app.user.id == user.id %}
        {% include "user/edit.html.twig" %}  
    {% endif %}
</section>

    <hr>
    <h1>abonnements {{user.follows | length}}</h1>
    <div class="swip ">
        <div class="swiper mySwiper">
            <div class="swiper-wrapper">
                
                {% for follow in user.follows %}
                <div class="swiper-slide card" style="{{follow.friend.style}}">
                    <h3 class="toptitre photo b-50 gris">
                        <img class="avatar" src="{{ follow.friend.imageName ? vich_uploader_asset(follow.friend, 'imageFile') : "https://fakeimg.pl/200x100" }}" alt="{{follow.friend.name}}">
                    </h3>
                    <h1>{{follow.friend.name}}
                        {% if app.user and app.user.id == user.id %}
                            <button type="button" class="btn-vierge yellow" value="{{user.id}}" data-follow-user >
                            
                                <i class="fa fa-user pointer yellow"></i>
                            
                            </button>
                        {% endif %}
                    </h1>
                    <h3 class="date">inscrit {{follow.friend.createdAt | ago}}</h3>
                    <h2>{{follow.friend.followers | length}} followers</h2>
                    {% if follow.friend.memes %}
                        <h2>{{follow.friend.memes | length }} memes postés</h2>
                        {% set moyenne = 0 %}
                        {% set nbVote = 0 %}
                        {% for row in follow.friend.memes %}
                            {% for note in row.noteMemes %}
                                {% set moyenne = moyenne + note.note %}
                                {% set nbVote = nbVote +1 %}
                            {% endfor %}
                        {% endfor %}
                        {% if nbVote > 0 %}
                            {% set moyenne = moyenne / nbVote %}
                            <h2>Moyenne memes {{ moyenne |round(2, 'floor') }}</h2>
                        {% endif %}
                    {% endif %}
                    {# <button>voir le profil</button> #}
                    <button  class="btn-vierge" ><a href="{{ path('app_user_profil', {'id': follow.friend.id}) }}">voir le profil</a></button>
                </div>
                {% endfor %}
                
            </div>

            <!-- If we need navigation buttons -->
            <div class="swiper-pagination"></div>

            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
        </div>
    </div>
    <hr>
    <h1>abonnés {{user.followers | length}}</h1>
    <div class="swip ">
        <div class="swiper mySwiper">
            <div class="swiper-wrapper">
                
                {% for follow in user.followers %}
                <div class="swiper-slide card" style="{{follow.user.style}}">
                    <h3 class="toptitre photo b-50 gris">
                        <img class="avatar" src="{{ follow.user.imageName ? vich_uploader_asset(follow.user, 'imageFile') : "https://fakeimg.pl/200x100" }}" alt="{{follow.user.name}}">
                    </h3>
                    <h1>{{follow.user.name}}
                        {% if app.user and app.user.id == user.id %}
                            <button type="button" class="btn-vierge yellow" value="{{follow.user.id}}" data-follow-user >
                                {% set fav = false %}
                                
                                {% for row in app.user.getFollows %}
                            
                                    {% if row.friend.id == follow.user.id %}
                                        {% set fav = true %}
                                    {% endif %}
                                {% endfor %}
                                {% if fav %}
                                    <i class="fa fa-user pointer yellow"></i>
                                {% else %}
                                    <i class="far fa-user pointer yellow"></i>
                                    
                                {% endif %}
 
                            </button>
                        {% endif %}
                    </h1>
                    <h3 class="date">inscrit {{follow.user.createdAt | ago}}</h3>
                    <h2>{{follow.user.followers | length}} followers</h2>
                    {% if follow.user.memes %}
                        <h2>{{follow.user.memes | length }} memes postés</h2>
                        {% set moyenne = 0 %}
                        {% set nbVote = 0 %}
                        {% for row in follow.user.memes %}
                            {% for note in row.noteMemes %}
                                {% set moyenne = moyenne + note.note %}
                                {% set nbVote = nbVote +1 %}
                            {% endfor %}
                        {% endfor %}
                        {% if nbVote > 0 %}
                            {% set moyenne = moyenne / nbVote %}
                            <h2>Moyenne memes {{ moyenne | round(2, 'floor') }}</h2>
                        {% endif %}
                    {% endif %}
                    <button class="btn-vierge"><a href="{{ path('app_user_profil', {'id': follow.user.id}) }}">voir le profil</a></button>
                    {# <a href="bb">dfgff sdg s sg </a> #}
                </div>
                {% endfor %}
                
            </div>
            <div class="swiper-pagination"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
        </div>
    </div>
    <hr>
    <h1>memes postés {{user.memes | length}}</h1>
    <div class="swip ">
        <div class="swiper mySwiper">
            <div class="swiper-wrapper">
                
                {% for meme in user.memes %}
                <div class="swiper-slide overflow-y card">
                    <h1 class="toptitre left {{meme.categorieId.style}}">&nbsp;{{meme.nom}}
                        {# {% if app.user and app.user.id == user.id %}

                        {% endif %} #}
                    </h1>
                    <h2 class="toptitre2 right {{meme.categorieId.style}}">
                        dans {{meme.categorieId.nom}} <span class="mute">{{meme.createdAt | ago}}</span>
                    </h2>
                    <h3 class="title">                
                    {% if  meme.getNoteMemes() | length > 0 %}
                    
                        {# {{dump(meme.getNoteMemes())}} #}
                        {% set somme = 0 %}
                        {% for row in meme.getNoteMemes() %}
                        {% set somme = somme + row.note
                        %}
                        
                        {% endfor %}
                        {% set somme = somme / (meme.getNoteMemes()| length) %}
                        <div class="note">
                            {% for i in 1..10 %}
                                {# {% if i <= somme * 2 %} #}
                                {% if i is odd %}
                                <i class="fa fa-star-half stars {{(i <= somme * 2) ? 'yellow' }}" ></i>
                                {% else %}
                                <i class="fa fa-star-half deg90 stars {{(i <= somme * 2) ? 'yellow' }}" ></i>
                                {% endif %}
                                {# {% endif %} #}
                            {% endfor %}
                        </div>
                    {% else %}
                        <span class="muted">pas encore de note</span> 
                    {% endif %}
                    </h3>
                    <div class="img">
                        <img class="memeImage" src="{{ meme ? vich_uploader_asset(meme, 'imageFile') : "https://fakeimg.pl/200x100" }}" alt="{{meme.nom}}">
                    </div>
                    <div class="description">
                        <p>{{meme.description}}</p>
                    </div>
                    <ul>
                        <li>{{meme.comments | length}} commentaires</li>
                        <li>{{meme.noteMemes | length}} notes reçus</li>
                        {# <li>{{meme.comments | length}} ajouter meme favoris</li> #}
                    </ul>
                    <button class="btn-vierge"><a href="{{ path('user_meme_show', {'id': meme.id}) }}">voir l'meme</a></button>
                    
                </div>
                {% endfor %}
                
            </div>
            <div class="swiper-pagination"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
        </div>
    </div>
    <hr>
    <h1>memes favoris {{user.memeFavoris | length}}</h1>
    <div class="swip ">
        <div class="swiper mySwiper">
            <div class="swiper-wrapper">
            {% for meme in user.memeFavoris %}
                <div class="swiper-slide overflow-y card">
                    <h1 class="toptitre left {{meme.meme.categorieId.style}}">&nbsp; - Posté par :  {{meme.meme.userId.name}}
                        <img 
                            class="avatarVrai" 
                            src="{{ meme.meme.userId ? vich_uploader_asset(meme.meme.userId, 'imageFile') : "https://fakeimg.pl/200x100" }}" 
                            alt="{{meme.meme.userId.name}}"
                        ></h1>
                    <h2 class="toptitre2 {{meme.meme.categorieId.style}}">{{meme.meme.nom}}</h2>
                    <h2 class="toptitre2 right {{meme.meme.categorieId.style}}">
                        dans {{meme.meme.categorieId.nom}} <span class="mute">{{meme.meme.createdAt | ago}}</span>
                    </h2>
                    <h3 class="title">                
                    {% if  meme.meme.getNoteMemes() | length > 0 %}
                    
                        {# {{dump(meme.getNoteMemes())}} #}
                        {% set somme = 0 %}
                        {% for row in meme.meme.getNoteMemes() %}
                        {% set somme = somme + row.note
                        %}
                        
                        {% endfor %}
                        {% set somme = somme / (meme.meme.getNoteMemes()| length) %}
                        <div class="note">
                            {% for i in 1..10 %}
                                {# {% if i <= somme * 2 %} #}
                                {% if i is odd %}
                                <i class="fa fa-star-half stars {{(i <= somme * 2) ? 'yellow' }}" ></i>
                                {% else %}
                                <i class="fa fa-star-half deg90 stars {{(i <= somme * 2) ? 'yellow' }}" ></i>
                                {% endif %}
                                {# {% endif %} #}
                            {% endfor %}
                        </div>
                    {% else %}
                        <span class="muted">pas encore de note</span> 
                    {% endif %}
                    </h3>
                    <div class="img">
                        <img class="memeImage" src="{{ meme.meme ? vich_uploader_asset(meme.meme, 'imageFile') : "https://fakeimg.pl/200x100" }}" alt="{{meme.meme.nom}}">
                    </div>
                    <div class="description">
                        <p>{{meme.meme.description}}</p>
                    </div>
                    <ul>
                        <li>{{meme.meme.comments | length}} commentaires</li>
                        <li>{{meme.meme.noteMemes | length}} notes reçus</li>
                        {# <li>{{meme.comments | length}} ajouter meme favoris</li> #}
                    </ul>
                    <button class="btn-vierge"><a href="{{ path('user_meme_show', {'id': meme.meme.id}) }}">voir l'meme</a></button>
                    
                </div>
            {% endfor %}
            </div>
            <div class="swiper-pagination"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
        </div>
    </div>
    <hr>
    <h1>memes notés {{user.noteMemes | length}}</h1>
    <div class="swip ">
        <div class="swiper mySwiper">
            <div class="swiper-wrapper">
            {% for meme in user.noteMemes %}
                <div class="swiper-slide overflow-y card">
                    <h1 class="toptitre left {{meme.meme.categorieId.style}}">&nbsp; - Posté par :  {{meme.meme.userId.name}}
                        <img 
                            class="avatarVrai" 
                            src="{{ meme.meme.userId ? vich_uploader_asset(meme.meme.userId, 'imageFile') : "https://fakeimg.pl/200x100" }}" 
                            alt="{{meme.meme.userId.name}}"
                        ></h1>
                    <h2 class="toptitre2 {{meme.meme.categorieId.style}}">{{meme.meme.nom}}</h2>
                    <h2 class="toptitre2 right {{meme.meme.categorieId.style}}">
                        dans {{meme.meme.categorieId.nom}} <span class="mute">{{meme.meme.createdAt | ago}}</span>
                    </h2>
                    <h3 class="title">                
                    {% if  meme.meme.getNoteMemes() | length > 0 %}
                    
                        {# {{dump(meme.getNoteMemes())}} #}
                        {% set somme = 0 %}
                        {% for row in meme.meme.getNoteMemes() %}
                        {% set somme = somme + row.note
                        %}
                        
                        {% endfor %}
                        {% set somme = somme / (meme.meme.getNoteMemes()| length) %}
                        <div class="note">
                            {% for i in 1..10 %}
                                {# {% if i <= somme * 2 %} #}
                                {% if i is odd %}
                                <i class="fa fa-star-half stars {{(i <= somme * 2) ? 'yellow' }}" ></i>
                                {% else %}
                                <i class="fa fa-star-half deg90 stars {{(i <= somme * 2) ? 'yellow' }}" ></i>
                                {% endif %}
                                {# {% endif %} #}
                            {% endfor %}
                        </div>
                    {% endif %}
                        <span class="muted">ta note : {{meme.note}}</span> 
                    </h3>
                    <div class="img">
                        <img class="memeImage" src="{{ meme.meme ? vich_uploader_asset(meme.meme, 'imageFile') : "https://fakeimg.pl/200x100" }}" alt="{{meme.meme.nom}}">
                    </div>
                    <div class="description">
                        <p>{{meme.meme.description}}</p>
                    </div>
                    <ul>
                        <li>{{meme.meme.comments | length}} commentaires</li>
                        <li>{{meme.meme.noteMemes | length}} notes reçus</li>
                        {# <li>{{meme.comments | length}} ajouter meme favoris</li> #}
                    </ul>
                    <button class="btn-vierge"><a href="{{ path('user_meme_show', {'id': meme.meme.id}) }}">voir l'meme</a></button>
                    
                </div>
            {% endfor %}
            </div>
            <div class="swiper-pagination"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
        </div>
    </div>
    {# {{ dump(user) }} #}

{% endblock %}